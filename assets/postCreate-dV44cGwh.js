import{r as t,k as J,j as e,C as O,B as m,I as r,d as S,y as n,z as Q}from"./index-CJ34pbwU.js";import{E as X,b as Y,i as Z,s as ee,h as se,a as ae,d as h,l as te,q as le,c as ne,e as re,f as ie,u as oe,o as ce,g as de,j as me,k as he,M as ue,r as pe}from"./server.browser-CI6EAX34.js";import{P as ge,a as xe,b as je,L as o,K as ve}from"./kakaoSearch-DZgM682i.js";import{C as fe}from"./chevron-left-CIzyo49A.js";import"./useKakaoLoader-D2aY65nM.js";function we(){const[u,I]=t.useState(""),[p,A]=t.useState(""),[P,g]=t.useState(!1),[c,x]=t.useState(null),[N,M]=t.useState(null),[d,z]=t.useState(void 0),[j,D]=t.useState(""),[C,L]=t.useState(""),[y,k]=t.useState(""),[w,E]=t.useState(""),[F,B]=t.useState(void 0),[T,U]=t.useState(void 0),[q,v]=t.useState(!1),f=J(),R=()=>u?p?d===void 0||isNaN(d)?(n.error("캠페인 ID를 입력해주세요."),!1):j.trim()?!0:(n.error("연락처를 입력해주세요."),!1):(n.error("내용을 입력해주세요."),!1):(n.error("제목을 입력해주세요."),!1),H=(s,l)=>{const a=s.target.value;l(a===""?void 0:parseFloat(a))},K=async()=>{if(!R())return;const s=e.jsx(ue,{rehypePlugins:[pe],children:p}),l=he.renderToStaticMarkup(s);try{const a={title:u,content:l,campaignId:d,visitInfo:{contactPhone:j||null,homepage:C||null,businessAddress:y||null,businessDetailAddress:w||null,lat:F??null,lng:T??null}};await S.post("/api/admin/posts",a),n.success("아티클이 생성되었습니다."),f("/posts")}catch(a){console.error("아티클 생성 오류:",a),n.error("아티클 생성에 실패했습니다.")}},V=async s=>{const l=s.name.split(".").pop()?.toLowerCase()||"jpg";try{n.info("이미지 업로드 중 입니다...");const i=(await S.post("/api/images/kokpost/presigned-url",{fileExtension:l})).data.data.presignedUrl.split("?")[0],b=s.type||"image/jpeg";return await Q.put(i,s,{headers:{"Content-Type":b}}),i}catch(a){throw n.error("이미지 업로드에 실패했습니다."),a}},$=(s,l)=>{x({url:s,name:l}),g(!0)},W=()=>{if(!c||!N)return;const{url:s,name:l}=c,a=`![${l}](${s})`;N.replaceSelection(a),g(!1),n.success("이미지가 삽입 되었습니다."),x(null)},_={name:"imageUpload",keyCommand:"imageUpload",buttonProps:{"aria-label":"Add image (ctrl + k)"},icon:e.jsx("svg",{width:"13",height:"13",viewBox:"0 0 20 20",children:e.jsx("path",{fill:"currentColor",d:"M15 9c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4-7H1c-.55 0-1 .45-1 1v14c0 .55.45 1 1 1h18c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm-1 13l-6-5-2 2-4-5-4 8V4h16v11z"})}),execute:async(s,l)=>{M(l);const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=async()=>{if(a.files&&a.files[0]){const i=a.files[0],b=await V(i);$(b,i.name)}},a.click()}},G=s=>{k(s.roadAddr),B(s.lat),U(s.lng),v(!1)};return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(fe,{onClick:()=>f("/posts"),className:"cursor-pointer"})}),e.jsx(O,{children:e.jsxs("div",{className:"flex flex-col items-center px-6",children:[e.jsxs("div",{className:"w-full","data-color-mode":"light",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-2 flex justify-between items-center",children:[e.jsx("div",{className:"ck-body-2 flex flex-col justify-end",children:"제목"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(ge,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(m,{variant:"outline",children:"필드 입력"})}),e.jsx(je,{className:"w-[500px]",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"leading-none font-medium",children:"필드 입력"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"아티클 생성을 위해 필드를 입력해주세요"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsxs(o,{htmlFor:"campaignId",children:["캠페인 ID"," ",e.jsx("span",{className:"text-ck-red-500",children:"*"})," 필수"]}),e.jsx("div",{className:"col-span-2",children:e.jsx(r,{id:"campaignId",type:"number",className:"h-8",placeholder:"캠페인 ID 입력하세요",value:d??"",onChange:s=>H(s,z)})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsxs(o,{htmlFor:"contactPhone",children:["연락처 ",e.jsx("span",{className:"text-ck-red-500",children:"*"})," ","필수"]}),e.jsx("div",{className:"col-span-2",children:e.jsx(r,{id:"contactPhone",className:"h-8",type:"number",placeholder:"01012345678",value:j,onChange:s=>{D(s.target.value)}})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(o,{htmlFor:"homepage",children:"홈페이지 주소"}),e.jsx(r,{id:"homepage",className:"col-span-2 h-8",placeholder:"https://chkok.kr",value:C,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(o,{htmlFor:"businessAddress",children:"위치 정보"}),e.jsxs("div",{className:"col-span-2 flex gap-2",children:[e.jsx(r,{id:"businessAddress",className:"h-8 flex-1",placeholder:"위치 정보 입력",value:y,onChange:s=>k(s.target.value)}),e.jsx(m,{variant:"outline",className:"h-8",onClick:()=>v(!0),children:"위치 검색"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(o,{htmlFor:"businessDetailAddress",children:"위치 정보 상세"}),e.jsx(r,{id:"businessDetailAddress",className:"col-span-2 h-8",placeholder:"위치 정보 상세 입력",value:w,onChange:s=>E(s.target.value)})]})]})]})})]}),e.jsx(m,{variant:"outline",onClick:()=>f("/posts"),children:"취소"}),e.jsx(m,{onClick:K,className:"px-4 py-2",variant:"outline",children:"생성"})]})]}),e.jsx(r,{value:u,onChange:s=>I(s.target.value),placeholder:"제목을 입력하세요",className:"w-full"})]}),e.jsx(X,{value:p,onChange:A,height:700,preview:"live",commands:[Y,Z,ee,se,ae,h,te,le,ne,re,ie,h,_,h,oe,ce,de,h,me]})]}),q&&e.jsx("div",{className:"absolute inset-0 z-10 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border max-w-2xl min-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"위치 검색"}),e.jsx(ve,{onSelect:G,onClose:()=>v(!1)})]})}),P&&e.jsx("div",{className:"absolute inset-0 z-10 flex h-full w-full items-center justify-center backdrop-blur-sm",children:e.jsxs("div",{className:"w-96 rounded-lg border bg-white p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"이미지 미리보기"}),e.jsx("div",{className:"rounded-lg border bg-gray-50 p-2",children:e.jsx("img",{src:c?.url,alt:c?.name,className:"h-auto max-w-full"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{g(!1),x(null)},className:"flex-1 rounded-md bg-gray-200 px-4 py-2 text-gray-700 transition-colors hover:bg-gray-300",children:"취소"}),e.jsx("button",{onClick:W,className:"flex-1 rounded-md bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-700",children:"설정"})]})]})})]})})]})}export{we as default};
