import{E as Y,F as Z,G as S,J as ee,K as O,L as M,r as d,M as se,N as te,j as e,C as F,a as I,S as a,b as w,d as y,B as m,k as re,p as ae,e as ie,I as v,y as o,z as ne}from"./index-CJ34pbwU.js";import{C as R}from"./chevron-left-CIzyo49A.js";import{u as le}from"./useQuery-D2kPODnq.js";import{A as K,a as B,b as T,c as q,d as L,e as P,f as Q,g as $,h as H}from"./alertDialog-_QB6fTsa.js";import{F as ce}from"./folder-input-CyGlubA3.js";var oe=class extends Y{#s;#r=void 0;#e;#t;constructor(s,t){super(),this.#s=s,this.setOptions(t),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const t=this.options;this.options=this.#s.defaultMutationOptions(s),Z(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),t?.mutationKey&&this.options.mutationKey&&S(t.mutationKey)!==S(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(s){this.#a(),this.#i(s)}getCurrentResult(){return this.#r}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#a(),this.#i()}mutate(s,t){return this.#t=t,this.#e?.removeObserver(this),this.#e=this.#s.getMutationCache().build(this.#s,this.options),this.#e.addObserver(this),this.#e.execute(s)}#a(){const s=this.#e?.state??ee();this.#r={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#i(s){O.batch(()=>{if(this.#t&&this.hasListeners()){const t=this.#r.variables,n=this.#r.context,r={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};s?.type==="success"?(this.#t.onSuccess?.(s.data,t,n,r),this.#t.onSettled?.(s.data,null,t,n,r)):s?.type==="error"&&(this.#t.onError?.(s.error,t,n,r),this.#t.onSettled?.(void 0,s.error,t,n,r))}this.listeners.forEach(t=>{t(this.#r)})})}};function E(s,t){const n=M(),[r]=d.useState(()=>new oe(n,s));d.useEffect(()=>{r.setOptions(s)},[r,s]);const i=d.useSyncExternalStore(d.useCallback(j=>r.subscribe(O.batchCalls(j)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),u=d.useCallback((j,p)=>{r.mutate(j,p).catch(se)},[r]);if(i.error&&te(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:u,mutateAsync:i.mutate}}function de(){return e.jsxs("div",{className:"grid-row grid px-6 py-2 min-w-[800px]",children:[e.jsx("div",{className:"mb-4",children:e.jsx(R,{className:"h-6 w-6 text-gray-400"})}),e.jsxs(F,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(a,{className:"h-7 w-32 ck-title"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(a,{className:"h-8 w-16 rounded-md"}),e.jsx(a,{className:"h-8 w-16 rounded-md"})]})]})}),e.jsxs(w,{className:"flex flex-col gap-4",children:[e.jsx(a,{className:"h-6 w-48 ck-sub-title-1"}),e.jsx(a,{className:"w-[500px] h-[281.25px] rounded-md"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 ck-body-2",children:[e.jsx(a,{className:"h-5 w-20"}),e.jsx(a,{className:"h-5 w-20"}),e.jsx(a,{className:"h-5 w-20"}),e.jsx(a,{className:"h-5 w-20"}),e.jsx(a,{className:"h-5 w-20"}),e.jsx(a,{className:"h-5 w-20"}),e.jsx(a,{className:"h-5 w-20"})]}),e.jsxs("div",{className:"flex flex-col gap-4 ck-body-2",children:[e.jsx(a,{className:"h-5 w-32"}),e.jsx(a,{className:"h-5 w-32"}),e.jsx(a,{className:"h-5 w-32"}),e.jsx(a,{className:"h-5 w-32"}),e.jsx(a,{className:"h-5 w-32"}),e.jsx(a,{className:"h-5 w-64"}),e.jsx(a,{className:"h-5 w-64"})]})]})]})]})]})}const he=async s=>(await y.get(`/api/banners/${s}`)).data.data,xe=async s=>{await y.delete(`/api/banners/${s}`)},ue=({buttonText:s,title:t,description:n,onAlert:r})=>({AlertDialogComponent:()=>e.jsxs(K,{children:[e.jsx(B,{asChild:!0,children:e.jsx(m,{variant:"outline",children:s})}),e.jsxs(T,{className:"w-[350px]",children:[e.jsxs(q,{children:[e.jsx(L,{children:t}),e.jsx(P,{children:n})]}),e.jsxs(Q,{children:[e.jsx($,{children:"취소"}),e.jsx(H,{onClick:()=>r(),children:"확인"})]})]})]})});function be(){const s=re(),{bannerId:t}=ae(),[n,r]=d.useState(!1),[i,u]=d.useState(null),[j,p]=d.useState(null),[g,C]=d.useState(!1),k=d.useRef(null),[c,_]=d.useState({title:"",bannerUrl:"",redirectUrl:"",description:"",position:""}),D=M(),{data:l,isPending:z}=le({queryKey:["bannersDetail",t],queryFn:()=>{if(!t)throw new Error("배너 ID가 없습니다.");return he(t)}}),U=async x=>{if(!c.title||!c.position){o.error("배너 이름과 위치를 입력해주세요.");return}r(!0);try{await y.put(`/api/banners/${x}`,{bannerUrl:j?.split("?")[0]||c.bannerUrl,redirectUrl:c.redirectUrl,title:c.title,description:c.description,position:c.position}),o.success("배너가 수정되었습니다."),r(!1),u(null),p(null)}catch(h){console.error(h),o.error("배너 수정에 실패했습니다.")}finally{r(!1)}},{mutate:G}=E({mutationFn:xe,onSuccess:()=>{o.success("배너가 성공적으로 삭제되었습니다."),D.invalidateQueries({queryKey:["bannersDetail",t]}),s("/banners")},onError:()=>{o.error("배너 삭제에 실패했습니다.")}});E({mutationFn:U,onSuccess:()=>{o.success("배너가 수정되었습니다."),D.invalidateQueries({queryKey:["bannersDetail",t]}),u(null),p(null)},onError:()=>{o.error("배너 수정을 실패했습니다.")}});const J=()=>{k.current?.click()},W=x=>{const h=x.target.files?.[0]||null;if(h&&!h.type.startsWith("image/")){o.error("이미지 파일만 업로드 가능합니다.");return}u(h)},V=async()=>{if(!i){o.error("이미지 파일을 선택해주세요.");return}C(!0);const x=i.name.split(".").pop()?.toLowerCase()||"jpg";try{const b=(await y.post("/api/images/banners/presigned-url",{fileExtension:x})).data.data.presignedUrl;p(b);const N=i.type||"image/jpeg";await ne.put(b,i,{headers:{"Content-Type":N}}),o.success("이미지가 업로드 되었습니다.")}catch(h){o.error("이미지 업로드에 실패했습니다."),console.error(h)}finally{C(!1)}},f=x=>{const{name:h,value:b}=x.target;_(N=>({...N,[h]:b}))},A=()=>{r(!n),n&&(u(null),p(null))},{AlertDialogComponent:X}=ue({buttonText:"삭제",title:"항목을 삭제하시겠습니까?",description:"이 작업은 되돌릴 수 없습니다.",onAlert:()=>t&&G(t)});return l?z?e.jsx(de,{}):e.jsxs("div",{className:"grid-row grid px-6 py-2",children:[e.jsx("div",{className:"mb-4",children:e.jsx(R,{onClick:()=>s("/banners"),className:"cursor-pointer"})}),e.jsxs(F,{children:[e.jsx(I,{children:e.jsx(ie,{className:"flex justify-between",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ck-title flex items-center",children:"배너 수정"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:W,className:"hidden",ref:k}),e.jsxs(m,{variant:"outline",onClick:J,disabled:g,children:[e.jsx(ce,{}),"이미지 선택"]}),i&&e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsxs("span",{className:"ck-body-2",children:["선택된 파일: ",i.name]}),e.jsx(m,{onClick:V,disabled:g||!i,variant:"outline",children:g?"업로드 중...":"파일 업로드"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(m,{onClick:A,variant:"outline",disabled:g,children:"취소"}),e.jsxs(K,{children:[e.jsx(B,{asChild:!0,children:e.jsx(m,{variant:"outline",children:"수정"})}),e.jsxs(T,{className:"w-[350px]",children:[e.jsxs(q,{children:[e.jsx(L,{children:"배너를 수정하시겠습니까?"}),e.jsx(P,{})]}),e.jsxs(Q,{children:[e.jsx($,{children:"취소"}),e.jsx(H,{onClick:()=>t&&U(t),children:"확인"})]})]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ck-title flex items-center",children:"배너 정보"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(X,{}),e.jsx(m,{onClick:A,variant:"outline",disabled:!l,children:"수정"})]})]})})}),n?e.jsxs(w,{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"ck-body-2-bold",children:"배너 위치"}),e.jsx(v,{id:"position",name:"position",value:c.position,onChange:f,placeholder:"배너 위치를 입력하세요",className:"ck-body-2 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"ck-body-2-bold",children:"배너 이름"}),e.jsx(v,{id:"title",name:"title",value:c.title,onChange:f,placeholder:"배너 이름을 입력하세요",className:"ck-body-2 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"ck-body-2-bold",children:"설명"}),e.jsx(v,{id:"description",name:"description",value:c.description,onChange:f,placeholder:"설명을 입력하세요",className:"ck-body-2 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"ck-body-2-bold",children:"Redirect URL"}),e.jsx(v,{id:"redirectUrl",name:"redirectUrl",value:c.redirectUrl,onChange:f,placeholder:"Redirect URL을 입력하세요",className:"ck-body-2 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2"})]})]}):e.jsxs(w,{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"ck-sub-title-1",children:l.title}),e.jsx("img",{src:l.bannerUrl,className:"w-[500px] aspect-video"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 ck-body-2 min-w-[100px]",children:[e.jsx("div",{children:"ID"}),e.jsx("div",{children:"배너 위치"}),e.jsx("div",{children:"생성일"}),e.jsx("div",{children:"업데이트일"}),e.jsx("div",{children:"설명"}),e.jsx("div",{children:"리다이렉트 주소"}),e.jsx("div",{children:"배너 주소"})]}),e.jsxs("div",{className:"flex flex-col gap-4 ck-body-2",children:[e.jsx("div",{children:l.id}),e.jsx("div",{children:l.position}),e.jsx("div",{children:l.createdAt}),e.jsx("div",{children:l.updatedAt}),e.jsx("div",{children:l.description}),e.jsx("a",{href:l.redirectUrl,target:"_blank",rel:"noopener noreferrer",children:l.redirectUrl}),e.jsx("a",{href:l.bannerUrl,target:"_blank",rel:"noopener noreferrer",children:l.bannerUrl})]})]})]})]})]}):e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx("div",{children:"데이터가 없습니다."})})}export{be as default};
