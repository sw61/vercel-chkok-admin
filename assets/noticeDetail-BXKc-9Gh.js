import{p as V,k as _,r,j as e,C as G,e as J,B as y,b as v,I as K,d as m,y as n,z as O}from"./index-CJ34pbwU.js";import{E as Q,b as W,i as X,s as Y,h as Z,a as ee,d as x,l as se,q as ae,c as te,e as ne,f as le,u as ie,o as re,g as oe,j as ce,M as de,r as me,k as xe}from"./server.browser-CI6EAX34.js";import{T as pe,M as he}from"./markdownDetailSkeleton-Cw1UEMvg.js";import{A as k,a as N,b as C,c as D,d as A,e as S,f as I,g as M,h as E}from"./alertDialog-_QB6fTsa.js";import{C as ue}from"./chevron-left-CIzyo49A.js";function ye(){const{markdownId:o}=V(),p=_(),[l,T]=r.useState(null),[c,h]=r.useState({title:"",content:""}),[L,f]=r.useState(!1),[z,u]=r.useState(!1),[d,g]=r.useState(null),[w,B]=r.useState(null),U=new pe({headingStyle:"atx",codeBlockStyle:"fenced"}),b=async a=>{f(!0);try{const t=(await m.get(`/api/admin/notices/${a}`)).data.data,i=U.turndown(t.content);T(t),h({title:t.title,content:i})}catch(s){console.log(s),n.error("마크다운 문서를 불러오는데 실패했습니다.")}finally{f(!1)}},$=async a=>{try{const s=e.jsx(de,{rehypePlugins:[me],children:c.content}),t=xe.renderToStaticMarkup(s);await m.put(`/api/admin/notices/${a}`,{title:c.title,content:t}),p("/notices"),n.success("문서가 수정되었습니다."),await b(o)}catch(s){console.log(s),n.error("문서 수정에 실패했습니다.")}},P=async a=>{try{await m.delete(`/api/admin/notices/${a}`),p("/notices"),n.success("문서가 삭제되었습니다.")}catch(s){console.log(s),n.error("문서 삭제에 실패했습니다.")}},q=async a=>{const s=a.name.split(".").pop()?.toLowerCase()||"jpg";try{n.info("이미지 업로드 중 입니다...");const i=(await m.post("/api/images/kokpost/presigned-url",{fileExtension:s})).data.data.presignedUrl.split("?")[0],j=a.type||"image/jpeg";return await O.put(i,a,{headers:{"Content-Type":j}}),i}catch(t){throw n.error("이미지 업로드에 실패했습니다."),t}},F=(a,s)=>{g({url:a,name:s}),u(!0)},H=()=>{if(!d||!w)return;const{url:a,name:s}=d,t=`![${s}](${a})`;w.replaceSelection(t),u(!1),n.success("이미지가 삽입되었습니다."),g(null)},R={name:"imageUpload",keyCommand:"imageUpload",buttonProps:{"aria-label":"Add image (ctrl + k)"},icon:e.jsx("svg",{width:"13",height:"13",viewBox:"0 0 20 20",children:e.jsx("path",{fill:"currentColor",d:"M15 9c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4-7H1c-.55 0-1 .45-1 1v14c0 .55.45 1 1 1h18c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm-1 13l-6-5-2 2-4-5-4 8V4h16v11z"})}),execute:async(a,s)=>{B(s);const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async()=>{if(t.files&&t.files[0]){const i=t.files[0],j=await q(i);F(j,i.name)}},t.click()}};return r.useEffect(()=>{o&&b(o)},[o]),L?e.jsx(he,{}):l?e.jsxs("div",{className:"w-full p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(ue,{onClick:()=>p("/notices"),className:"cursor-pointer"})}),e.jsxs(G,{className:"min-w-[800px] px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-6",children:[e.jsx(J,{className:"ck-title",children:"공지사항"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(k,{children:[e.jsx(N,{asChild:!0,children:e.jsx(y,{className:"px-4 py-2",variant:"outline",children:"삭제"})}),e.jsxs(C,{className:"w-[350px]",children:[e.jsxs(D,{children:[e.jsx(A,{children:"문서를 삭제하시겠습니까?"}),e.jsx(S,{children:"이 작업은 되돌릴 수 없습니다"})]}),e.jsxs(I,{children:[e.jsx(M,{children:"취소"}),e.jsx(E,{onClick:()=>P(l.id),children:"확인"})]})]})]}),e.jsxs(k,{children:[e.jsx(N,{asChild:!0,children:e.jsx(y,{className:"px-4 py-2",variant:"outline",children:"수정"})}),e.jsxs(C,{className:"w-[350px]",children:[e.jsxs(D,{children:[e.jsx(A,{children:"문서를 수정하시겠습니까?"}),e.jsx(S,{})]}),e.jsxs(I,{children:[e.jsx(M,{children:"취소"}),e.jsx(E,{onClick:()=>$(l.id),children:"확인"})]})]})]})]})]}),e.jsxs(v,{className:"ck-body-2 flex  gap-6",children:[e.jsxs("p",{children:["작성자: ",l?.authorName]}),e.jsxs("p",{children:["생성일: ",l?.createdAt.split("T")[0]]}),e.jsxs("p",{children:["수정일: ",l?.updatedAt.split("T")[0]]}),e.jsxs("p",{children:["조회수: ",l?.viewCount]})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"제목"}),e.jsx(K,{value:c.title,onChange:a=>h(s=>({...s,title:a.target.value})),placeholder:"제목을 입력하세요",className:"w-full"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"내용"}),e.jsx(Q,{value:c.content,onChange:a=>h(s=>({...s,content:a||""})),height:500,preview:"live",commands:[W,X,Y,Z,ee,x,se,ae,te,ne,le,x,R,x,ie,re,oe,x,ce]})]})]})]}),z&&e.jsx("div",{className:"absolute inset-0 z-10 flex h-full w-full items-center justify-center backdrop-blur-sm",children:e.jsxs("div",{className:"w-96 rounded-lg border bg-white p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"이미지 미리보기"}),e.jsx("div",{className:"rounded-lg border bg-gray-50 p-2",children:e.jsx("img",{src:d?.url,alt:d?.name,className:"h-auto max-w-full"})})]}),e.jsx("div",{className:"mb-6 grid grid-cols-2 gap-4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{u(!1),g(null)},className:"flex-1 rounded-md bg-gray-200 px-4 py-2 text-gray-700 transition-colors hover:bg-gray-300",children:"취소"}),e.jsx("button",{onClick:H,className:"flex-1 rounded-md bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-700",children:"설정"})]})]})})]}):e.jsx("div",{children:"데이터 없음"})}export{ye as default};
