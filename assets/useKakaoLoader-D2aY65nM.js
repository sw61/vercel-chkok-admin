import{r as d,R as L,j as x,aG as ne}from"./index-CJ34pbwU.js";const S=typeof window<"u"&&typeof document<"u"?d.useLayoutEffect:d.useEffect,p=(s,e,t)=>{S(()=>{if(!s||!t)return;const n=function(){for(var u=arguments.length,f=new Array(u),i=0;i<u;i++)f[i]=arguments[i];return f===void 0?t(s):t(s,...f)};return kakao.maps.event.addListener(s,e,n),()=>{kakao.maps.event.removeListener(s,e,n)}},[s,e,t])},F="__react-kakao-maps-sdk__";let O=function(s){return s[s.INITIALIZED=0]="INITIALIZED",s[s.LOADING=1]="LOADING",s[s.SUCCESS=2]="SUCCESS",s[s.FAILURE=3]="FAILURE",s}({});const ae=`${F}_Loader`;class r{static loadEventCallback=new Set;callbacks=[];done=!1;loading=!1;errors=[];constructor(e){let{appkey:t,id:n=ae,libraries:u=[],nonce:f,retries:i=3,url:w="//dapi.kakao.com/v2/maps/sdk.js"}=e;if(this.id=n,this.appkey=t,this.libraries=u,this.nonce=f,this.retries=i,this.url=w,r.instance&&!r.equalOptions(this.options,r.instance.options)&&!r.equalOptions(this.options,r.instance.options))switch(r.instance.status){case O.FAILURE:throw new Error(`Loader must not be called again with different options. 
${JSON.stringify(this.options,null,2)}
!==
${JSON.stringify(r.instance.options,null,2)}`);default:r.instance.reset(),r.instance=this;break}return r.instance||(r.instance=this),r.instance}get options(){return{appkey:this.appkey,id:this.id,libraries:this.libraries,nonce:this.nonce,retries:this.retries,url:this.url}}static addLoadEventLisnter(e){return window.kakao&&window.kakao.maps&&window.kakao.maps.load(e),r.loadEventCallback.add(e),e}static removeLoadEventLisnter(e){return r.loadEventCallback.delete(e)}load(){return new Promise((e,t)=>{this.loadCallback(n=>{n?t(n):e(window.kakao)})})}get status(){return this.onEvent?O.FAILURE:this.done?O.SUCCESS:this.loading?O.LOADING:O.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}loadCallback(e){this.callbacks.push(e),this.execute()}resetIfRetryingFailed(){this.failed&&this.reset()}reset(){this.deleteScript(),this.done=!0,this.loading=!1,this.errors=[],this.onEvent=void 0}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.kakao&&window.kakao.maps){console.warn("Kakao Maps이 이미 외부 요소에 의해 로딩되어 있습니다.설정한 옵션과 일치 하지 않을 수 있으며, 이에 따른 예상치 동작이 발생할 수 있습니다."),window.kakao.maps.load(this.callback);return}this.loading||(this.loading=!0,this.setScript())}}setScript(){document.getElementById(this.id)&&this.callback();const e=this.createUrl(),t=document.createElement("script");t.id=this.id,t.type="text/javascript",t.src=e,t.onerror=this.loadErrorCallback.bind(this),t.onload=this.callback.bind(this),t.defer=!0,t.async=!0,this.nonce&&(t.nonce=this.nonce),document.head.appendChild(t)}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const t=this.errors.length*2**this.errors.length;console.log(`Failed to load Kakao Maps script, retrying in ${t} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},t)}else this.done=!0,this.loading=!1,this.onEvent=this.errors[this.errors.length-1],this.callbacks.forEach(t=>{t(this.onEvent)}),this.callbacks=[],r.loadEventCallback.forEach(t=>{t(this.onEvent)})}createUrl(){let e=this.url;return e+=`?appkey=${this.appkey}`,this.libraries.length&&(e+=`&libraries=${this.libraries.join(",")}`),e+="&autoload=false",e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}callback(){kakao.maps.load(()=>{r.instance.done=!0,r.instance.loading=!1,r.instance.callbacks.forEach(e=>{e(r.instance.onEvent)}),r.instance.callbacks=[],r.loadEventCallback.forEach(e=>{e(r.instance.onEvent)})})}static equalOptions(e,t){if(e.appkey!==t.appkey||e.id!==t.id||e.libraries.length!==t.libraries.length)return!1;for(let n=0;n<e.libraries.length;++n)if(e.libraries[n]!==t.libraries[n])return!1;return!(e.nonce!==t.nonce||e.retries!==t.retries||e.url!==t.url)}}const c=function(s,e){for(var t=arguments.length,n=new Array(t>2?t-2:0),u=2;u<t;u++)n[u-2]=arguments[u];S(()=>{!s||n.every(f=>typeof f>"u")||s[e].call(s,...n)},[s,e,...n])},K=L.createContext(void 0),de=L.forwardRef(function(e,t){let{id:n,as:u,children:f,center:i,isPanto:w=!1,padding:C=32,disableDoubleClick:l,disableDoubleClickZoom:h,draggable:E,zoomable:I,keyboardShortcuts:k,level:v,maxLevel:M,minLevel:R,mapTypeId:b,projectionId:A,scrollwheel:z,tileAnimation:D,onBoundsChanged:y,onCenterChanged:P,onClick:o,onDoubleClick:N,onDrag:Z,onDragEnd:$,onDragStart:W,onIdle:q,onMaptypeidChanged:G,onMouseMove:H,onRightClick:J,onTileLoaded:B,onZoomChanged:Q,onZoomStart:V,onCreate:T,...X}=e;const Y=u||"div",[j,_]=d.useState(!1),[a,ee]=d.useState(),U=d.useRef(null);return S(()=>{const m=r.addLoadEventLisnter(g=>_(!g));return()=>{r.removeLoadEventLisnter(m)}},[]),S(()=>{if(!j)return;const m=U.current;if(!m)return;const g="lat"in i?new kakao.maps.LatLng(i.lat,i.lng):new kakao.maps.Coords(i.x,i.y),te=new kakao.maps.Map(m,{center:g,disableDoubleClick:l,disableDoubleClickZoom:h,draggable:E,keyboardShortcuts:k,level:v,mapTypeId:typeof b=="string"?kakao.maps.MapTypeId[b]:b,projectionId:A,scrollwheel:z,tileAnimation:D});return ee(te),()=>{m.innerHTML=""}},[j,l,h,D]),d.useImperativeHandle(t,()=>a,[a]),S(()=>{!a||!T||T(a)},[a,T]),S(()=>{if(!a)return;let m=a.getCenter();m instanceof kakao.maps.Coords&&(m=m.toLatLng());const g="lat"in i?new kakao.maps.LatLng(i.lat,i.lng):new kakao.maps.Coords(i.x,i.y);g instanceof kakao.maps.LatLng&&g.equals(m)||g instanceof kakao.maps.Coords&&g.toLatLng().equals(m)||(w?a.panTo(g,C):a.setCenter(g))},[a,i.lat,i.lng,i.x,i.y]),c(a,"setDraggable",E),c(a,"setZoomable",I),c(a,"setKeyboardShortcuts",k),c(a,"setLevel",v),c(a,"setMapTypeId",j?typeof b=="string"?kakao.maps.MapTypeId[b]:b:void 0),c(a,"setProjectionId",A),c(a,"setMinLevel",M),c(a,"setMaxLevel",R),p(a,"bounds_changed",y),p(a,"center_changed",P),p(a,"click",o),p(a,"dblclick",N),p(a,"drag",Z),p(a,"dragstart",W),p(a,"dragend",$),p(a,"idle",q),p(a,"maptypeid_changed",G),p(a,"mousemove",H),p(a,"rightclick",J),p(a,"tilesloaded",B),p(a,"zoom_changed",Q),p(a,"zoom_start",V),x.jsxs(x.Fragment,{children:[x.jsx(Y,{id:n||`${F}_Map`,...X,ref:U}),a&&x.jsx(K.Provider,{value:a,children:f})]})}),se=s=>{const e=d.useContext(K);if(!e)throw new Error(`${s+" Component"} must exist inside Map Component!`);return e},ie=L.forwardRef(function(e,t){let{map:n,position:u,marker:f,children:i,altitude:w,disableAutoPan:C,range:l,removable:h,zIndex:E,onCreate:I}=e;const k=d.useMemo(()=>{const M=document.createElement("div");return M.style.display="none",new kakao.maps.InfoWindow({altitude:w,disableAutoPan:C,range:l,removable:h,zIndex:E,content:M,position:u})},[C,h]),v=d.useMemo(()=>k.getContent(),[k]);return d.useImperativeHandle(t,()=>k,[k]),d.useLayoutEffect(()=>(k.open(n,f),()=>{k.close()}),[n,f]),d.useLayoutEffect(()=>{I&&I(k)},[k,I]),c(k,"setPosition",u),c(k,"setAltitude",w),c(k,"setRange",l),c(k,"setZIndex",E),ne.createPortal(i,v.parentElement??v)}),oe=L.createContext(void 0),re=L.forwardRef(function(e,t){let{map:n,position:u,children:f,altitude:i,clickable:w,draggable:C,image:l,infoWindowOptions:h,onCreate:E,onClick:I,onDragEnd:k,onDragStart:v,onMouseOut:M,onMouseOver:R,opacity:b,range:A,title:z,zIndex:D}=e;const y=d.useContext(oe),P=d.useMemo(()=>l&&new kakao.maps.MarkerImage(l.src,new kakao.maps.Size(l.size.width,l.size.height),{alt:l.options?.alt,coords:l.options?.coords,offset:l.options?.offset&&new kakao.maps.Point(l.options?.offset.x,l.options?.offset.y),shape:l.options?.shape,spriteOrigin:l.options?.spriteOrigin&&new kakao.maps.Point(l.options?.spriteOrigin.x,l.options?.spriteOrigin.y),spriteSize:l.options?.spriteSize&&new kakao.maps.Size(l.options?.spriteSize.width,l.options?.spriteSize.height)}),[JSON.stringify(l)]),o=d.useMemo(()=>new kakao.maps.Marker({altitude:i,clickable:w,draggable:C,image:P,opacity:b,range:A,title:z,zIndex:D,position:u}),[]);return d.useImperativeHandle(t,()=>o,[o]),d.useLayoutEffect(()=>y?(y.addMarker(o,!0),()=>y.removeMarker(o,!0)):(o.setMap(n),()=>o.setMap(null)),[n,y,o]),d.useLayoutEffect(()=>{E&&E(o)},[o,E]),c(o,"setPosition",u),c(o,"setImage",P),c(o,"setAltitude",i),c(o,"setClickable",w),c(o,"setDraggable",C),c(o,"setOpacity",b),c(o,"setRange",A),c(o,"setTitle",z),c(o,"setZIndex",D),p(o,"click",I),p(o,"dragstart",v),p(o,"dragend",k),p(o,"mouseout",M),p(o,"mouseover",R),f?x.jsx(ie,{position:u,map:n,marker:o,altitude:h?.altitude,disableAutoPan:h?.disableAutoPan,range:h?.range,removable:h?.removable,zIndex:h?.zIndex,children:f}):null}),ue=L.forwardRef(function(e,t){let{position:n,...u}=e;const f=se("MapMarker"),i=d.useMemo(()=>"lat"in n?new kakao.maps.LatLng(n.lat,n.lng):new kakao.maps.Coords(n.x,n.y).toLatLng(),[n.lat,n.lng,n.x,n.y]);return x.jsx(re,{map:f,position:i,...u,ref:t})}),le=s=>{const[e,t]=d.useState([!0,void 0]);return d.useEffect(()=>{new r({...s}).load().then(()=>t([!1,void 0])).catch(n=>{t([!1,n])})},[JSON.stringify(s)]),e};function pe(){le({appkey:"b899a61d66595623703778dff5e36515",libraries:["clusterer","drawing","services"]})}export{de as M,ue as a,pe as u};
