import{p as re,k as oe,r as n,j as e,C as ce,e as de,B as c,I as d,b as B,d as p,y as l,z as me}from"./index-CJ34pbwU.js";import{E as he,b as ue,i as pe,s as xe,h as ge,a as je,d as x,l as fe,q as ve,c as be,e as Ne,f as we,u as ke,o as ye,g as Ce,j as Ae,M as De,r as Se,k as Ie}from"./server.browser-CI6EAX34.js";import{T as Pe,M as Me}from"./markdownDetailSkeleton-Cw1UEMvg.js";import{A as F,a as z,b as $,c as U,d as q,e as H,f as R,g as K,h as V}from"./alertDialog-_QB6fTsa.js";import{P as Le,a as Te,b as Ee,L as g,K as Be}from"./kakaoSearch-DZgM682i.js";import{C as Fe}from"./chevron-left-CIzyo49A.js";import"./useKakaoLoader-D2aY65nM.js";function Ve(){const{markdownId:m}=re(),j=oe(),[r,_]=n.useState(null),[o,f]=n.useState({title:"",content:""}),[G,I]=n.useState(!1),[J,v]=n.useState(!1),[h,b]=n.useState(null),[P,O]=n.useState(null),[N,w]=n.useState(""),[M,k]=n.useState(""),[L,u]=n.useState(""),[T,y]=n.useState(""),[Q,C]=n.useState(void 0),[W,A]=n.useState(void 0),[X,D]=n.useState(!1),Y=new Pe({headingStyle:"atx",codeBlockStyle:"fenced"}),Z=()=>o.title?o.content?N.trim()?!0:(l.error("연락처를 입력해주세요."),!1):(l.error("내용을 입력해주세요."),!1):(l.error("제목을 입력해주세요."),!1),E=async s=>{I(!0);try{const a=(await p.get(`/api/admin/posts/${s}`)).data.data,i=Y.turndown(a.content);_(a),f({title:a.title,content:i}),a.visitInfo?(w(a.visitInfo.contactPhone||""),k(a.visitInfo.homepage||""),u(a.visitInfo.businessAddress||""),y(a.visitInfo.businessDetailAddress||""),C(a.visitInfo.lat??void 0),A(a.visitInfo.lng??void 0)):(w(""),k(""),u(""),y(""),C(void 0),A(void 0))}catch(t){console.log(t),l.error("아티클을 불러오는데 실패했습니다.")}finally{I(!1)}},ee=async s=>{if(Z())try{const t=e.jsx(De,{rehypePlugins:[Se],children:o.content}),a=Ie.renderToStaticMarkup(t),i={title:o.title,content:a,visitInfo:{contactPhone:N||null,homepage:M||null,businessAddress:L||null,businessDetailAddress:T||null,lat:Q??null,lng:W??null}};await p.put(`/api/admin/posts/${s}`,i),l.success("아티클이 수정되었습니다."),await E(m)}catch(t){console.log(t),l.error("아티클 수정에 실패했습니다.")}},se=async s=>{try{await p.delete(`/api/admin/posts/${s}`),j("/posts"),l.success("아티클가 삭제되었습니다.")}catch(t){console.log(t),l.error("아티클 삭제에 실패했습니다.")}},ae=async s=>{const t=s.name.split(".").pop()?.toLowerCase()||"jpg";try{l.info("이미지 업로드 중 입니다...");const i=(await p.post("/api/images/kokpost/presigned-url",{fileExtension:t})).data.data.presignedUrl.split("?")[0],S=s.type||"image/jpeg";return await me.put(i,s,{headers:{"Content-Type":S}}),i}catch(a){throw l.error("이미지 업로드에 실패했습니다."),a}},te=(s,t)=>{b({url:s,name:t}),v(!0)},ne=()=>{if(!h||!P)return;const{url:s,name:t}=h,a=`![${t}](${s})`;P.replaceSelection(a),v(!1),l.success("이미지가 삽입되었습니다."),b(null)},le={name:"imageUpload",keyCommand:"imageUpload",buttonProps:{"aria-label":"Add image (ctrl + k)"},icon:e.jsx("svg",{width:"13",height:"13",viewBox:"0 0 20 20",children:e.jsx("path",{fill:"currentColor",d:"M15 9c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4-7H1c-.55 0-1 .45-1 1v14c0 .55.45 1 1 1h18c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm-1 13l-6-5-2 2-4-5-4 8V4h16v11z"})}),execute:async(s,t)=>{O(t);const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=async()=>{if(a.files&&a.files[0]){const i=a.files[0],S=await ae(i);te(S,i.name)}},a.click()}},ie=s=>{u(s.roadAddr),C(s.lat),A(s.lng),D(!1)};return n.useEffect(()=>{m&&E(m)},[m]),G?e.jsx(Me,{}):r?e.jsxs("div",{className:"min-w-[800px] p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(Fe,{onClick:()=>j("/posts"),className:"cursor-pointer"})}),e.jsxs(ce,{className:"w-full px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-6",children:[e.jsx(de,{className:"ck-title",children:"체험콕 글"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(Le,{children:[e.jsx(Te,{asChild:!0,children:e.jsx(c,{variant:"outline",children:"필드 입력"})}),e.jsx(Ee,{className:"w-[500px]",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"leading-none font-medium",children:"필드 입력"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"글 수정을 위해 필드를 입력해주세요"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsxs(g,{htmlFor:"contactPhone",children:["연락처 ",e.jsx("span",{className:"text-ck-red-500",children:"*"})," 필수"]}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{id:"contactPhone",className:"h-8",placeholder:"01012345678",value:N,onChange:s=>w(s.target.value)})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(g,{htmlFor:"homepage",children:"홈페이지 주소"}),e.jsx(d,{id:"homepage",className:"col-span-2 h-8",placeholder:"https://chkok.kr",value:M,onChange:s=>k(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(g,{htmlFor:"businessAddress",children:"위치 정보"}),e.jsxs("div",{className:"col-span-2 flex gap-2",children:[e.jsx(d,{id:"businessAddress",className:"h-8 flex-1",placeholder:"위치 정보 입력",value:L,onChange:s=>u(s.target.value)}),e.jsx(c,{variant:"outline",className:"h-8",onClick:()=>D(!0),children:"위치 검색"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(g,{htmlFor:"businessDetailAddress",children:"위치 정보 상세"}),e.jsx(d,{id:"businessDetailAddress",className:"col-span-2 h-8",placeholder:"위치 정보 상세 입력",value:T,onChange:s=>y(s.target.value)})]})]})]})})]}),e.jsxs(F,{children:[e.jsx(z,{asChild:!0,children:e.jsx(c,{className:"px-4 py-2",variant:"outline",children:"삭제"})}),e.jsxs($,{className:"w-[350px]",children:[e.jsxs(U,{children:[e.jsx(q,{children:"아티클을 삭제하시겠습니까?"}),e.jsx(H,{children:"이 작업은 되돌릴 수 없습니다"})]}),e.jsxs(R,{children:[e.jsx(K,{children:"취소"}),e.jsx(V,{onClick:()=>se(r.id),children:"확인"})]})]})]}),e.jsxs(F,{children:[e.jsx(z,{asChild:!0,children:e.jsx(c,{className:"px-4 py-2",variant:"outline",children:"수정"})}),e.jsxs($,{className:"w-[350px]",children:[e.jsxs(U,{children:[e.jsx(q,{children:"아티클을 수정하시겠습니까?"}),e.jsx(H,{})]}),e.jsxs(R,{children:[e.jsx(K,{children:"취소"}),e.jsx(V,{onClick:()=>ee(r.id),children:"확인"})]})]})]})]})]}),e.jsxs(B,{className:"ck-body-2 flex justify-between gap-6 items-center",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("p",{children:["작성자 : ",r?.authorName]}),e.jsxs("p",{children:["생성일 : ",r?.createdAt.split("T")[0]]}),e.jsxs("p",{children:["수정일 : ",r?.updatedAt.split("T")[0]]}),e.jsxs("p",{children:["조회수 : ",r?.viewCount]})]}),e.jsx(c,{variant:"link",onClick:()=>j(`/campaigns/${r.campaignId}`),children:"캠페인 보러 가기"})]}),e.jsxs(B,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"제목"}),e.jsx(d,{value:o.title,onChange:s=>f(t=>({...t,title:s.target.value})),placeholder:"제목을 입력하세요",className:"w-full"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"내용"}),e.jsx(he,{value:o.content,onChange:s=>f(t=>({...t,content:s||""})),height:500,preview:"live",commands:[ue,pe,xe,ge,je,x,fe,ve,be,Ne,we,x,le,x,ke,ye,Ce,x,Ae]})]})]})]}),X&&e.jsx("div",{className:"absolute inset-0 z-10 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border max-w-2xl min-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"위치 검색"}),e.jsx(Be,{onSelect:ie,onClose:()=>D(!1)})]})}),J&&e.jsx("div",{className:"absolute inset-0 z-10 flex h-full w-full items-center justify-center backdrop-blur-sm",children:e.jsxs("div",{className:"w-96 rounded-lg border bg-white p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"이미지 미리보기"}),e.jsx("div",{className:"rounded-lg border bg-gray-50 p-2",children:e.jsx("img",{src:h?.url,alt:h?.name,className:"h-auto max-w-full"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{v(!1),b(null)},className:"flex-1 rounded-md bg-gray-200 px-4 py-2 text-gray-700 transition-colors hover:bg-gray-300",children:"취소"}),e.jsx("button",{onClick:ne,className:"flex-1 rounded-md bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-700",children:"설정"})]})]})})]}):e.jsx("div",{children:"데이터 없음"})}export{Ve as default};
